(()=>{Telegram.WebApp.ready();let e=Telegram.WebApp.initData;console.log("ðŸŽ® window.location.href323 ",window.location.href),window.location.href.includes("localhost:3000")?e="user=%7B%22id%22%3A317600571%2C%22first_name%22%3A%22%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B0%D0%BD%D0%B4%D1%80%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22aleksandrrr_n%22%2C%22language_code%22%3A%22ru%22%2C%22is_premium%22%3Atrue%2C%22allows_write_to_pm%22%3Atrue%2C%22photo_url%22%3A%22https%3A%5C%2F%5C%2Ft.me%5C%2Fi%5C%2Fuserpic%5C%2F320%5C%2FlcHASOH7fiK4aSZX9v9XBudEdIE7m91wkR957a1XpZs.svg%22%7D&chat_instance=-7090027097801552795&chat_type=channel&auth_date=1736270286&signature=VTQpsQKQrOuHEX-Z6KVDT81nmHxDBeYiJXoo47PLTdZfk0z4hdneRFl3ITwjZGAfm8CSWfgiKtLARchvv5fpCg&hash=29fba79d9b9a8ec4393469d47b0a5c08d9f93958ca226c81dcd521d9892ee55b":window.location.href.includes("teremok.space")&&(e=Telegram.WebApp.initData);let t=null,n=null,o=0,s=null,a=0,l=null,i=null,r=null,c=null,d=document.getElementById("div_my_mems"),m=null,u=null;const g=[1,2,10,11,13,15,17,20,29,32,37,42,43,50,51,54,57,62,70,75,77,85,88,105,114];!function(){const e=document.getElementById("container_avatars");let t="";function n(){Array.from(e.querySelectorAll("img")).forEach(e=>{e.classList.remove("selected")}),this.classList.add("selected")}g.forEach(e=>{t+=`<img data-name="${e}" src="/assets/mem_img/svg/mem_${e}.svg"/>`}),e.innerHTML=t,Array.from(e.querySelectorAll("img")).forEach(e=>{e.addEventListener("click",n)})}(),document.getElementById("div_user_info").addEventListener("click",function(){const e=document.getElementById("container_user_data");"block"===e.style.display?e.style.display="none":e.style.display="block"}),document.getElementById("btn_save_user_data").addEventListener("click",function(){let e="",t=document.getElementById("input_user_nick").value;const n=document.getElementById("container_avatars");Array.from(n.querySelectorAll("img")).forEach(t=>{t.classList.contains("selected")&&(e=t.getAttribute("data-name"))}),""!==t?""!==e?me("post","save_user_data",{name:t,ava:e}).then(e=>{y(e.user),document.getElementById("container_user_data").style.display="none"}).catch(e=>console.log(e)):alert("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð°Ð²Ð°Ñ‚Ð°Ñ€"):U("good","Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¸Ðº")});const _=document.getElementById("btn_click_energy");function y(e){m=e,document.getElementById("user_name").innerText=e.name,document.getElementById("user_ava").src=`/assets/mem_img/svg/mem_${e.ava}.svg`,document.getElementById("input_user_nick").value=e.name,document.querySelectorAll(".value_coins").forEach(t=>{t.innerText=e.coins}),document.getElementById("current_dollars").innerText=`~${(4.06*e.coins).toFixed(2)}$`,b(e.energy),e.premium&&(document.querySelectorAll(".open_premium").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".text_cost_participant").forEach(e=>{e.innerText="Ð—Ð° ÑƒÑ‡Ð°ÑÑ‚Ð¸Ðµ +30"}),document.querySelectorAll(".text_cost_winner").forEach(e=>{e.innerText="Ð—Ð° ÑƒÑ‡Ð°ÑÑ‚Ð¸Ðµ +150"})),e.registered_in_tournament&&(document.getElementById("btn_tournament_register").style.display="none",document.getElementById("div_tournament_registered").style.display="block")}me("post","get_user_data",{}).then(e=>{document.getElementById("page_load").style.display="none",document.getElementById("page_main").style.display="block",m=e.user,u=e.constants,y(e.user),ie(),document.querySelector('[data-page="main"] .big_img').src="assets/mem_img/gif/mem_20.gif",document.querySelector('[data-page="friends"] .big_img').src="assets/mem_img/gif/mem_98.gif",document.querySelector('[data-page="tournament"] .big_img').src="assets/mem_img/gif/mem_75.gif",document.querySelector('[data-page="clicker"] .big_img').src="assets/mem_img/gif/mem_41.gif",document.querySelector("#container_error .container_big_img img").src="assets/mem_img/gif/mem_57.gif",document.querySelector("#container_premium .container_big_img img").src="assets/mem_img/gif/mem_14.gif",document.querySelector("#container_finish_game .big_img").src="assets/mem_img/gif/mem_1.gif",me("post","get_user_friends",{}).then(e=>{e.friends.length>0&&function(e){let t="";e.forEach(e=>{t+=`\n      <div class="friend_item">\n        <div class="base_info">\n          <img src="assets/mem_img/svg/mem_${e.ava}.svg" />\n          <div>${e.name}</div>\n        </div>\n\n        <div class="second_info">\n          <div class="container text_with_icon">+500 <img src="img/coin.svg"/></div>\n\n          <div class="date">${e.date}</div>\n        </div>\n      </div>\n    `}),document.getElementById("div_friends_list").innerHTML=t}(e.friends)}).catch(e=>console.log(e))}).catch(e=>console.log(e));const p=75;function b(e){let t=parseFloat(e).toFixed(1);t>m.energy_max&&(t=m.energy_max),document.querySelectorAll(".value_energy").forEach(e=>{e.innerText=t}),document.querySelectorAll(".top_bar .value_energy").forEach(e=>{e.innerText=parseInt(t)});let n=100*e/m.energy_max;n>100&&(n=100),document.querySelectorAll(".top_bar .energy_bar").forEach(e=>e.style.width=`${n}%`);let o=t;o==m.energy_max&&(o-=.001);let s=o%p*100/p;document.querySelectorAll('[data-page="clicker"] .energy_bar').forEach(e=>e.style.width=`${s}%`);let a=parseInt(parseInt(t)/p);document.getElementById("text_games_count").innerText=`${a} Ð¸Ð³Ñ€`}document.getElementById("btn_invite_friend").addEventListener("click",function(){document.getElementById("btn_invite_friend").style.display="none",document.getElementById("div_btns_invite").style.display="block"}),document.getElementById("btn_invite_message").addEventListener("click",function(){me("post","create_tg_message").then(e=>{Telegram.WebApp.shareMessage(e.message.result.id)}).catch(e=>console.log(e))}),document.getElementById("btn_invite_link").addEventListener("click",function(){navigator.clipboard.writeText(`https://t.me/mem_culture_bot?start=in_${m.tg_id}`),document.getElementById("btn_invite_link").innerText="Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°!"}),Telegram.WebApp.expand();let v=null,f=null,h=null,E=null;window.addEventListener("beforeunload",()=>{console.log("ðŸ”Œ [disconnectWebSocket] Cleaning up WebSocket connections..."),v&&(console.log("ðŸ”Œ [disconnectWebSocket] Unsubscribing from game channel"),v.unsubscribe(),v=null),f&&(console.log("ðŸ”Œ [disconnectWebSocket] Unsubscribing from round channel"),f.unsubscribe(),f=null),h&&(console.log("ðŸ”Œ [disconnectWebSocket] Unsubscribing from vote channel"),h.unsubscribe(),h=null),E&&(console.log("ðŸ”Œ [disconnectWebSocket] Unsubscribing from restart channel"),E.unsubscribe(),E=null),actionCableConsumer&&(console.log("ðŸ”Œ [disconnectWebSocket] Disconnecting Action Cable"),actionCableConsumer.disconnect()),console.log("ðŸ”Œ [disconnectWebSocket] Cleanup completed")}),document.addEventListener("visibilitychange",()=>{}),eruda.init();let I=eruda.get("console");I.log("eruda"),I.log("initData ",Telegram.WebApp.initData),I.log("initDataUnsafe ",Telegram.WebApp.initDataUnsafe),I.log("initData user ",Telegram.WebApp.initDataUnsafe.user),I.log("href ",window.location.href),I.log("WebAppInitData1 ",Telegram.WebAppInitData),I.log("WebAppInitData2 ",Telegram.webAppInitData),I.log("WebAppInitData3 ",Telegram.webAppInitDataUnsafe),I.log("WebView ",Telegram.WebView),I.log("Telegram ",Telegram);const T=document.getElementById("div_video"),B=document.getElementById("my_mem_video"),k=document.getElementById("my_mem_mp4"),C=document.getElementById("container_game_participants");document.getElementById("btn_create").addEventListener("click",function(){document.getElementById("btn_enter").style.display="none",document.getElementById("container_finish_game").style.display="none",$.innerText="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²...",F.innerText="",N.style.display="none",G.style.width="0%","block"==C.style.display?me("post","create_game",{participants:parseInt(S.innerText)}).then(e=>{e.error?U("bad",e.error):(document.getElementById("page_main").style.display="none",document.getElementById("page_game").style.display="block",document.getElementById("game_question").innerText=`ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð´Ñ€ÑƒÐ·ÑŒÑÐ¼ ÐºÐ¾Ð´ ${e.game.uniq_id} Ð´Ð»Ñ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ðº Ð¸Ð³Ñ€Ðµ`,d.innerHTML="",d.style.display="none",i=e.game,c=e.user_id,q())}).catch(e=>console.log(e)):document.getElementById("container_game_participants").style.display="block"});const S=document.getElementById("game_participants");function U(e,t){document.getElementById("container_error").style.display="block",document.getElementById("error_text").innerText=t,document.querySelector("#container_error img").src="good"==e?"assets/mem_img/gif/mem_11.gif":"assets/mem_img/gif/mem_57.gif"}document.getElementById("btn_add_participant").addEventListener("click",function(){let e=parseInt(S.innerText)+1;e<=5&&(S.innerText=e)}),document.getElementById("btn_remove_participant").addEventListener("click",function(){let e=parseInt(S.innerText)-1;e>=3&&(S.innerText=e)});const A=document.getElementById("input_game_code");function w(){me("post","find_game",{participants:parseInt(S.innerText)}).then(e=>{e.error?U("bad",e.error):x(e.game,e.user_id)}).catch(e=>console.log(e))}function x(e,t){document.getElementById("container_finish_game").style.display="none",$.innerText="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²...",F.innerText="",G.style.width="0%",N.style.display="none",document.getElementById("game_winner").style.display="none",document.getElementById("page_main").style.display="none",document.getElementById("page_game").style.display="block",d.style.display="none",i=e,c=t,q()}function q(){null!=t&&clearInterval(t),W([]),L()}function L(){console.log("ðŸ”— [subscribeToGameUpdates] Starting WebSocket connection for game updates..."),console.log("ðŸ”— [subscribeToGameUpdates] Game ID:",i?.id,"User ID:",c),i&&i.id?c?(v&&(console.log("ðŸ”— [subscribeToGameUpdates] Unsubscribing from previous subscription"),v.unsubscribe(),v=null),actionCableConsumer.shouldReconnect=!0,console.log("ðŸ”— [subscribeToGameUpdates] Connecting to Action Cable..."),actionCableConsumer.connect("/cable",{user_id:c}),console.log("ðŸ”— [subscribeToGameUpdates] Creating subscription to GameChannel..."),v=actionCableConsumer.subscribe("GameChannel",{game_id:i.id}),v.connected=()=>{console.log("ðŸŽ® [subscribeToGameUpdates] âœ… Connected to game channel")},v.disconnected=()=>{console.log("âŒ [subscribeToGameUpdates] Disconnected from game channel"),setTimeout(()=>{v&&actionCableConsumer.cable?.readyState===WebSocket.OPEN||(console.log("ðŸ”„ [subscribeToGameUpdates] Falling back to polling due to WebSocket disconnect"),console.log("ðŸ”„ Using polling for game updates..."),t=setInterval(()=>{me("post","get_update_game_ready",{game_id:i.id}).then(e=>{console.log("ðŸŽ® get_update_game_ready (polling)",e),D(e)}).catch(e=>{console.log("âŒ Polling error:",e),clearInterval(t),setTimeout(()=>L(),3e3)})},1e3))},2e3)},v.received=e=>{console.log("ðŸŽ® [subscribeToGameUpdates] WebSocket game update received:",e),D(e)},console.log("ðŸ”— [subscribeToGameUpdates] Subscription setup completed")):console.error("âŒ [subscribeToGameUpdates] No user_id available"):console.error("âŒ [subscribeToGameUpdates] No game data available")}function D(e){console.log("ðŸŽ¯ [handleGameUpdate] Processing game update:",e),console.log("ðŸŽ¯ [handleGameUpdate] Users count:",e.users?.length,"Ready to start:",e.ready_to_start),W(e.users),function(e,t){const n=document.getElementById("div_players");t.forEach(e=>{n.querySelector(`.div_player[data-id="${e.game_user_number}"]`).classList.remove("winner")})}(e.game,e.users),e.ready_to_start?(console.log("ðŸŽ¯ [handleGameUpdate] Game is ready to start! Starting game..."),setTimeout(()=>{d.style.display="flex",console.log("ðŸŽ¯ [handleGameUpdate] Showing mems selection")},550),v&&(console.log("ðŸŽ¯ [handleGameUpdate] Unsubscribing from game updates"),v.unsubscribe(),v=null),t&&(console.log("ðŸŽ¯ [handleGameUpdate] Clearing polling timeout"),clearInterval(t),t=null),V()):console.log("ðŸŽ¯ [handleGameUpdate] Game not ready yet, continuing to wait...")}function W(e){let t="";if(e.forEach(e=>{let n=e.game_points;t+=`<div class="div_player" data-id="${e.game_user_number}">\n                <div class="user_points">${n}<span class="new_points"></span></div>\n                <img src="/assets/mem_img/svg/mem_${e.user_ava}.svg"/>\n                <div class="user_name">${function(e){let t=e;return t.length>10&&(t=e.slice(0,10)+"..."),t}(e.user_name)}</div>\n              </div>`}),e.length<i.participants)for(let n=0;n<i.participants-e.length;n++)t+='<div class="div_player">\n                  <div class="user_points">&#8203;</div>\n                  <img src="/assets/square.svg"/>\n                  <div class="user_name">&#8203;</div>\n                </div>';document.getElementById("div_players").innerHTML=t}function R(e){user_in_game=!1,e.forEach(e=>{e.user_id==c&&(user_in_game=!0)}),user_in_game||window.location.reload()}document.getElementById("btn_enter").addEventListener("click",function(){document.getElementById("btn_create").style.display="none";const e=parseInt(A.value);console.log("game_code ",e),0===e||null==e||isNaN(e)?document.getElementById("container_game_code").style.display="block":me("post","join_to_game",{game_code:e}).then(e=>{e.error?U("bad",e.error):(document.getElementById("page_main").style.display="none",document.getElementById("page_game").style.display="block",document.getElementById("btn_restart_game").style.display="none",d.style.display="none",i=e.game,c=e.user_id,q())}).catch(e=>console.log(e))}),document.getElementById("btn_new_game").addEventListener("click",function(){w()}),document.getElementById("btn_find_game").addEventListener("click",function(){document.getElementById("container_finish_game").style.display="none",$.innerText="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²...",F.innerText="",G.style.width="0%",N.style.display="none",w()});const $=document.getElementById("game_question"),G=document.getElementById("progress_line"),N=document.getElementById("container_progress_line"),F=document.getElementById("progress_comment");function V(){null!=n&&clearInterval(n),F.innerText="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ð¼ÐµÐ¼Ñ‹...",setTimeout(()=>{console.log("ðŸ”— [subscribeToRoundUpdates] Starting WebSocket connection for round updates..."),console.log("ðŸ”— [subscribeToRoundUpdates] Game ID:",i?.id,"User ID:",c),i&&i.id?c?(f&&(console.log("ðŸ”— [subscribeToRoundUpdates] Unsubscribing from previous subscription"),f.unsubscribe(),f=null),actionCableConsumer.shouldReconnect=!0,console.log("ðŸ”— [subscribeToRoundUpdates] Connecting to Action Cable..."),actionCableConsumer.connect("/cable",{user_id:c}),console.log("ðŸ”— [subscribeToRoundUpdates] Creating subscription to RoundChannel..."),f=actionCableConsumer.subscribe("RoundChannel",{game_id:i.id}),f.connected=()=>{console.log("ðŸŽ® [subscribeToRoundUpdates] âœ… Connected to round channel")},f.disconnected=()=>{console.log("âŒ [subscribeToRoundUpdates] Disconnected from round channel")},f.received=e=>{console.log("ðŸŽ® [subscribeToRoundUpdates] WebSocket round update received:",e),function(e){$.innerText=e.question,G.style.width=e.round_progress_wait+"%",N.style.display="block",R(e.users),W(e.users),o=e.round_progress_left,null!=n&&clearInterval(n),n=setInterval(()=>{o-=M,G.style.width=o/u.round_duration*100+"%"},M),e.my_mems&&function(e){if(!e||!Array.isArray(e))return void console.warn("ðŸŽ® [setMyMems] my_mems is not a valid array:",e);let t="";e.forEach(e=>{const n=e.active?"":'<div class="mem_inactive"></div>';t+=`<div class="mem_card" data-name="${e.name}" data-active="${e.active}"><img src="assets/mem_video/${e.name}.png"/>${n}</div>`}),document.getElementById("div_my_mems").innerHTML=t,Array.from(document.querySelectorAll("#div_my_mems .mem_card")).forEach(function(e){e.addEventListener("click",H)})}(e.my_mems),e.ready_to_open&&(r=e.round,f&&(console.log("ðŸ”— [handleRoundUpdate] Unsubscribing from round channel - round ready to open"),f.unsubscribe(),f=null),null!=n&&clearInterval(n),O=e.mems,Array.from(document.getElementsByClassName("container_video_mem")).forEach(e=>{e.classList.remove("voted")}),F.innerText="",G.style.width="0%",N.style.display="none",B.pause(),T.style.display="none",document.getElementById("div_round_result").style.display="block",d.style.display="none",O.forEach((e,t)=>{const n=document.getElementById(`div_video_${t}`);n.querySelector(".mem_sender_name").innerText=e.name,n.querySelector(".user_avatar").src=`/assets/mem_img/svg/mem_${e.avatar}.svg`,n.querySelector("source").src=`assets/mem_video/${e.mem}.mp4`,n.querySelector(".mem_vote").style.display="none",n.querySelector(".mem_vote").style.visibility="visible",n.querySelector(".mem_vote").setAttribute("data-user-num",e.user_num),n.classList.remove("my"),e.user_id===c&&(n.classList.add("my"),n.querySelector(".mem_vote").style.visibility="hidden")}),X.style.display="flex",Z.load(),Z.play())}(e)},console.log("ðŸ”— [subscribeToRoundUpdates] Subscription setup completed")):console.error("âŒ [subscribeToRoundUpdates] No user_id available"):console.error("âŒ [subscribeToRoundUpdates] No game data available")},1e3)}let M=50;function H(){if("true"===this.getAttribute("data-active")){const e=this.getAttribute("data-name");T.style.display="flex",k.src=`assets/mem_video/${e}.mp4`,P.innerText="ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ",P.setAttribute("data-mem-name",e),B.load(),B.play()}}const P=document.getElementById("btn_send");P.addEventListener("click",function(){const e=this.getAttribute("data-mem-name");d.style.display="none",me("post","send_round_mem",{game_id:i.id,mem_name:e}).then(e=>{Array.from(document.getElementsByClassName("div_mem")).forEach(e=>{e.style.display="none"}),P.innerText="Ð–Ð´Ñ‘Ð¼..."}).catch(e=>console.log(e))});let O=[{name:"Name1",avatar:"avatar",mem:"zhestko"},{name:"Name2",avatar:"avatar",mem:"aeroflot"},{name:"Name3",avatar:"avatar",mem:"lavochka_zakrita"}];const X=document.getElementById("div_video_0"),Z=document.getElementById("mem_0_video"),j=document.getElementById("div_video_1"),K=document.getElementById("mem_1_video"),z=document.getElementById("div_video_2"),Q=document.getElementById("mem_2_video"),J=document.getElementById("div_video_3"),Y=document.getElementById("mem_3_video"),ee=document.getElementById("div_video_4"),te=document.getElementById("mem_4_video");function ne(){O.forEach((e,t)=>{const n=document.getElementById(`div_video_${t}`);n.querySelector(".mem_vote").style.display="block",n.querySelector(".mem_vote").addEventListener("click",oe)}),me("post","start_voting",{game_id:i.id,round_id:r.id}).then(e=>{}).catch(e=>console.log(e)),console.log("Wait for vote"),null!=s&&clearInterval(s),F.innerText="Ð“Ð¾Ð»Ð¾ÑÑƒÐµÐ¼...",console.log("ðŸ”— [subscribeToVoteUpdates] Starting WebSocket connection for vote updates..."),console.log("ðŸ”— [subscribeToVoteUpdates] Game ID:",i?.id,"User ID:",c),i&&i.id?c?(h&&(console.log("ðŸ”— [subscribeToVoteUpdates] Unsubscribing from previous subscription"),h.unsubscribe(),h=null),actionCableConsumer.shouldReconnect=!0,console.log("ðŸ”— [subscribeToVoteUpdates] Connecting to Action Cable..."),actionCableConsumer.connect("/cable",{user_id:c}),console.log("ðŸ”— [subscribeToVoteUpdates] Creating subscription to VoteChannel..."),h=actionCableConsumer.subscribe("VoteChannel",{game_id:i.id}),h.connected=()=>{console.log("ðŸŽ® [subscribeToVoteUpdates] âœ… Connected to vote channel")},h.disconnected=()=>{console.log("âŒ [subscribeToVoteUpdates] Disconnected from vote channel")},h.received=e=>{console.log("ðŸŽ® [subscribeToVoteUpdates] WebSocket vote update received:",e),function(e){console.log("ðŸŽ® [handleVoteUpdate] Processing vote update:",e),function(e){document.getElementById("div_round_result");const t=document.getElementById("div_players");e.forEach(e=>{e.votes>0&&(t.querySelector(`.div_player[data-id="${e.user_num}"] .new_points`).innerText=`+${e.votes}`)})}(e.mems),N.style.display="block",R(e.users),a=e.vote_progress_left,null!=s&&clearInterval(s),s=setInterval(()=>{a-=M,G.style.width=a/u.vote_duration*100+"%"},M),e.vote_finish&&(h&&(console.log("ðŸ”— [handleVoteUpdate] Unsubscribing from vote channel - voting finished"),h.unsubscribe(),h=null),null!=s&&clearInterval(s),W(e.users),e.finish_game?(document.getElementById("div_question").style.display="none",document.getElementById("div_round_result").style.display="none",me("post","get_game_winner",{game_id:i.id}).then(e=>{W(e.users),e.winners_ids.forEach(e=>{document.querySelector(`.div_player[data-id="${e}"]`).classList.add("winner")}),document.getElementById("div_question").style.display="block",document.getElementById("game_question").innerText="Ð•Ñ‰Ðµ Ð¸Ð³Ñ€Ñƒ?",document.getElementById("container_finish_game").style.display="block",document.getElementById("game_winner").style.display="block",document.getElementById("game_winner").innerText=`ÐŸÐ¾Ð±ÐµÐ´Ð¸Ñ‚ÐµÐ»ÑŒ ${e.winners_names}`,console.log("Wait for restart"),null!=l&&clearInterval(l),console.log("ðŸ”— [subscribeToRestartUpdates] Starting WebSocket connection for restart updates..."),console.log("ðŸ”— [subscribeToRestartUpdates] Game ID:",i?.id,"User ID:",c),i&&i.id?c?(E&&(console.log("ðŸ”— [subscribeToRestartUpdates] Unsubscribing from previous subscription"),E.unsubscribe(),E=null),actionCableConsumer.shouldReconnect=!0,console.log("ðŸ”— [subscribeToRestartUpdates] Connecting to Action Cable..."),actionCableConsumer.connect("/cable",{user_id:c}),console.log("ðŸ”— [subscribeToRestartUpdates] Creating subscription to RestartChannel..."),E=actionCableConsumer.subscribe("RestartChannel",{game_id:i.id}),E.connected=()=>{console.log("ðŸ”„ [subscribeToRestartUpdates] âœ… Connected to restart channel")},E.disconnected=()=>{console.log("âŒ [subscribeToRestartUpdates] Disconnected from restart channel"),setTimeout(()=>{E&&actionCableConsumer.cable?.readyState===WebSocket.OPEN||(console.log("ðŸ”„ [subscribeToRestartUpdates] Falling back to polling due to WebSocket disconnect"),console.log("ðŸ”„ [timeoutRestartWaitPolling] Starting polling fallback"),l=setInterval(()=>{me("post","get_restart_update",{game_id:i.id}).then(e=>{console.log("get_restart_update ",e),se(e)}).catch(e=>console.log(e))},1e3))},2e3)},E.received=e=>{console.log("ðŸ”„ [subscribeToRestartUpdates] WebSocket restart update received:",e),se(e)},console.log("ðŸ”— [subscribeToRestartUpdates] Subscription setup completed")):console.error("âŒ [subscribeToRestartUpdates] No user_id available"):console.error("âŒ [subscribeToRestartUpdates] No game data available")}).catch(e=>console.log(e))):(d.style.display="flex",Array.from(document.getElementsByClassName("div_mem")).forEach(e=>{e.style.display="none"}),Array.from(document.getElementsByClassName("container_video_mem")).forEach(e=>{e.classList.remove("voted")}),window.scrollTo(0,0),V()))}(e)},console.log("ðŸ”— [subscribeToVoteUpdates] Subscription setup completed")):console.error("âŒ [subscribeToVoteUpdates] No user_id available"):console.error("âŒ [subscribeToVoteUpdates] No game data available")}function oe(){Array.from(document.querySelectorAll(".mem_vote")).forEach(e=>{e.style.visibility="hidden"}),this.parentElement.parentElement.querySelector(".container_video_mem").classList.add("voted");const e=this.getAttribute("data-user-num");console.log("voteForMem ",e),me("post","vote_for_mem",{user_num:e,round_id:r.id}).then(e=>{}).catch(e=>console.log(e))}function se(e){console.log("ðŸ”„ [handleRestartUpdate] Processing restart update:",e),G.style.width=e.restart_progress_wait+"%",N.style.display="block",W(e.users),function(e,t){const n=document.getElementById("div_players");t.forEach(e=>{e.ready_to_restart&&(n.querySelector(`.div_player[data-id="${e.game_user_number}"]`).querySelector(".user_points").innerText="Ð“Ð¾Ñ‚Ð¾Ð²")})}(e.game,e.users),e.winners_ids.forEach(e=>{document.querySelector(`.div_player[data-id="${e}"]`).classList.add("winner")}),e.ready_to_start&&(E&&(console.log("ðŸ”— [handleRestartUpdate] Unsubscribing from restart channel - restart finished"),E.unsubscribe(),E=null),null!=l&&clearInterval(l),i.id==e.new_game.id?window.location.reload():x(e.new_game,e.user_id))}Z.onended=function(e){j.style.display="flex",K.load(),K.play()},K.onended=function(e){O.length>2?(z.style.display="flex",Q.load(),Q.play()):ne()},Q.onended=function(e){O.length>3?(J.style.display="flex",Y.load(),Y.play()):ne()},Y.onended=function(e){O.length>4?(ee.style.display="flex",te.load(),te.play()):ne()},te.onended=function(e){ne()},document.getElementById("btn_restart_game").addEventListener("click",function(){document.getElementById("container_finish_game").style.display="none",document.getElementById("game_question").innerText="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ñ…...",me("post","ready_to_restart",{game_id:i.id}).then(e=>{e.error&&U("bad",e.error)}).catch(e=>console.log(e))});let ae=null,le=1;function ie(){const e=function(){const e=Math.ceil(1),t=Math.floor(114);return Math.floor(Math.random()*(t-e)+e)}();_.src=`assets/mem_img/svg/mem_${e}.svg`}function re(){const e=this.getAttribute("data-page");document.querySelectorAll(".page_main").forEach(e=>e.style.display="none"),document.querySelectorAll(".nav_bottom").forEach(e=>e.classList.remove("active")),document.querySelector(`.page_main[data-page="${e}"]`).style.display="flex",document.querySelector(`.nav_bottom[data-page="${e}"]`).classList.add("active"),document.body.scrollTo(0,0),document.querySelectorAll(".nav_bottom img").forEach(t=>{const n=t.parentElement.parentElement.getAttribute("data-page"),o=e==n?"selected":"common";t.src=`./img/nav/${o}/${n}.svg`})}function ce(){document.getElementById("container_premium").style.display="block"}function de(){document.querySelectorAll(".bottom_container").forEach(e=>e.style.display="none")}function me(t,n,o=null){const s={"Content-type":"application/json",TelegramData:e};return fetch(`/${n}`,{method:t,body:JSON.stringify(o),headers:s}).then(e=>e.json())}_.addEventListener("click",function(){m.energy+=m.premium?1.1:.1,b(m.energy),null!=ae&&clearTimeout(ae),le+=1,le%25==0&&ie(),ae=setTimeout(()=>{me("post","update_energy",{energy:m.energy}).then(e=>{m.energy=e.energy,b(m.energy)}).catch(e=>console.log(e))},500)}),document.querySelectorAll(".nav_bottom").forEach(e=>e.addEventListener("click",re)),document.getElementById("btn_tournament_register").addEventListener("click",()=>{me("post","register_in_tournament").then(e=>{e.error?U("bad",e.error):y(e.user)}).catch(e=>console.log(e))}),document.getElementById("btn_buy_premium").addEventListener("click",()=>{me("post","get_payment_link").then(e=>{Telegram.WebApp.openInvoice(e.link)}).catch(e=>console.log(e))}),Telegram.WebApp.onEvent("invoiceClosed",function(e){"paid"==e.status&&U("good","ÐŸÑ€ÐµÐ¼Ð¸ÑƒÐ¼ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ 2Ñ… Ð¼Ð¸Ð½ÑƒÑ‚")}),document.querySelectorAll(".open_premium").forEach(e=>e.addEventListener("click",ce)),document.querySelectorAll(".bottom_container .background").forEach(e=>e.addEventListener("click",de)),document.getElementById("btn_close_error").addEventListener("click",()=>{de()}),document.getElementById("current_dollars").addEventListener("click",()=>{U("good","Ð Ð°ÑÑ‡ÐµÑ‚Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð²Ð°ÑˆÐ¸Ñ… Ð¼Ð¾Ð½ÐµÑ‚ Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð»Ð¸ÑÑ‚Ð¸Ð½Ð³Ð°")}),function(){const e=document.getElementById("profit_graph");new Chart(e,{type:"line",data:{labels:["14.01","30.01","14.02","28.02","14.03","30.03","15.04","30.04","15.05","30.05","15.06","30.06"],datasets:[{label:"Ð¦ÐµÐ½Ð°",data:[.05,.1,.3,.5,.8,1,1.1,1.3,1.6,2,2.7,4.1],borderColor:"#FF7F5C",backgroundColor:"#FF7F5C"}]},options:{responsive:!0,plugins:{legend:{display:!1}},animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}}}})}(),document.getElementById("btn_converter").addEventListener("click",()=>{me("post","convert_energy").then(e=>{e.error?U("bad",e.error):(le=0,y(e.user))}).catch(e=>console.log(e))})})();