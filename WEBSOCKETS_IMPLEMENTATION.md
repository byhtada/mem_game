# üîå WebSocket —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –∏–≥—Ä—ã

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–µ—Ä–µ–¥–µ–ª–∞–Ω –º–µ—Ç–æ–¥ `get_update_game_ready` —Å polling –Ω–∞ –≤–µ–±-—Å–æ–∫–µ—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Action Cable**.

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ë—ç–∫–µ–Ω–¥ (Rails)

1. **GameChannel** (`app/channels/game_channel.rb`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ

2. **RoundChannel** (`app/channels/round_channel.rb`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏–≥—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∏–≥—Ä–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—É–Ω–¥–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ

3. **VoteChannel** (`app/channels/vote_channel.rb`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∏–≥—Ä–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ

4. **Connection** (`app/channels/application_cable/connection.rb`)
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ `user_id` –ø–∞—Ä–∞–º–µ—Ç—Ä
   - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è Action Cable

5. **Game Model** (`app/models/game.rb`)
   - –ú–µ—Ç–æ–¥ `broadcast_game_update()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ broadcasting –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
   - Broadcasting –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤

6. **Round Model** (`app/models/round.rb`)
   - –ú–µ—Ç–æ–¥ `broadcast_round_update()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ä–∞—É–Ω–¥–∞
   - –ú–µ—Ç–æ–¥ `broadcast_vote_update()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ broadcasting –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—É–Ω–¥–∞
   - Broadcasting –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ–º–æ–≤ –∏ –≥–æ–ª–æ—Å–æ–≤ –∏–≥—Ä–æ–∫–∞–º–∏

7. **–ú–∞—Ä—à—Ä—É—Ç—ã** (`config/routes.rb`)
   - –î–æ–±–∞–≤–ª–µ–Ω endpoint `/cable` –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (JavaScript)

1. **Action Cable Consumer** (`memgame_web/js/consumer.js`)
   - –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Action Cable –∫–ª–∏–µ–Ω—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–≤—è–∑–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã** (`memgame_web/js/app.js`)
   - –§—É–Ω–∫—Ü–∏—è `subscribeToGameUpdates()` –¥–ª—è WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∏–≥—Ä—É
   - –§—É–Ω–∫—Ü–∏—è `subscribeToRoundUpdates()` –¥–ª—è WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ä–∞—É–Ω–¥
   - –§—É–Ω–∫—Ü–∏—è `subscribeToVoteUpdates()` –¥–ª—è WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
   - Fallback –Ω–∞ polling –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å WebSocket
   - –û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `handleGameUpdate()`, `handleRoundUpdate()` –∏ `handleVoteUpdate()` –¥–ª—è –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–∞–∑–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∏–≥—Ä—ã:
1. –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∏–≥—Ä—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `timeoutGameWait()`
2. –ï—Å–ª–∏ –≤–µ–±-—Å–æ–∫–µ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `GameChannel`
3. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ –≤ –º–æ–¥–µ–ª–∏ Game –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `broadcast_game_update`
4. –í—Å–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ `ready_to_start: true` –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è

### –§–∞–∑–∞ —Ä–∞—É–Ω–¥–∞:
1. –ü—Ä–∏ –Ω–∞—á–∞–ª–µ —Ä–∞—É–Ω–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `timeoutRoundWait()`
2. –ï—Å–ª–∏ –≤–µ–±-—Å–æ–∫–µ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `RoundChannel`
3. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–º–∞ –≤ –º–æ–¥–µ–ª–∏ Round –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `broadcast_round_update`
4. –í—Å–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ –º–µ–º–∞—Ö
5. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ `ready_to_open: true` –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è

### –§–∞–∑–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:
1. –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `timeoutVotesWait()`
2. –ï—Å–ª–∏ –≤–µ–±-—Å–æ–∫–µ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `VoteChannel`
3. –ü—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏ –≤ –º–æ–¥–µ–ª–∏ Round –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `broadcast_vote_update`
4. –í—Å–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ –≥–æ–ª–æ—Å–∞—Ö
5. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è

### –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
6. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å WebSocket –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ polling

## üîÄ Fallback –º–µ—Ö–∞–Ω–∏–∑–º

- **WebSocket –∞–∫—Ç–∏–≤–µ–Ω**: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –Ω–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- **WebSocket –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTP polling
- **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –≤–º–µ—Å—Ç–æ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã
- üìâ **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤)
- üîÑ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —Å fallback –Ω–∞ polling
- üß© **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `rails server`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/test_websockets.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –£–∫–∞–∂–∏—Ç–µ User ID –∏ Game ID
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GameChannel
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools -> Network -> WS
2. –°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. –î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RoundChannel
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: `ruby test_round_websocket.rb`
2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –æ—Ç–∫—Ä–æ–π—Ç–µ `/test_round_websockets.html`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VoteChannel
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: `ruby test_vote_websocket.rb`
2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –æ—Ç–∫—Ä–æ–π—Ç–µ `/test_vote_websockets.html`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GameChannel
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –æ—Ç–∫—Ä–æ–π—Ç–µ `/test_websockets.html`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- **–í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å WebSocket**: `isWebSocketsEnabled = true/false` –≤ `app.js`
- **URL WebSocket**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/cable`
- **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ

## üìù –õ–æ–≥–∏

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
- `üîó Connected to Action Cable`
- `üéÆ Connected to game channel`
- `üéÆ WebSocket game update received:`
- `üéÆ Connected to round channel`
- `üéÆ WebSocket round update received:`
- `üéÆ Connected to vote channel`
- `üéÆ WebSocket vote update received:`
- `üîÑ Falling back to polling due to WebSocket disconnect`

## üöß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- `get_update_game_ready` (–æ–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä—ã) ‚Üí **GameChannel**
- `get_round_update` (–æ–∂–∏–¥–∞–Ω–∏–µ —Ä–∞—É–Ω–¥–∞) ‚Üí **RoundChannel**
- `get_vote_update` (–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ) ‚Üí **VoteChannel**

### üîÑ –ú–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å:
- `get_restart_update` (—Ä–µ—Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã) ‚Üí **RestartChannel**

–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Redis –∞–¥–∞–ø—Ç–µ—Ä
- **–ü—Ä–æ–±–ª–µ–º–∞**: `Gem::LoadError` - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª Redis gem
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `gem "redis", ">= 4.0.1"` –≤ Gemfile
- **Development**: –ù–∞—Å—Ç—Ä–æ–µ–Ω `async` –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ Redis –≤ development

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ GameUser –∑–∞–ø–∏—Å–µ–π –≤ broadcasting
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `.reload.order(:created_at)` –≤ `users_for_broadcast`

### Action Cable –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è  
- **Development**: `adapter: async` (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç Redis)
- **Production**: `adapter: redis` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è)

## üìÅ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `public/test_websockets.html` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä GameChannel —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `public/test_round_websockets.html` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä RoundChannel —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π  
- `public/test_vote_websockets.html` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä VoteChannel —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `test_websocket.rb` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è GameChannel
- `test_round_websocket.rb` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è RoundChannel
- `test_vote_websocket.rb` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è VoteChannel
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –ø–æ–¥–ø–∏—Å–∫—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ real-time

## üìã –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **GameChannel** - WebSocket –∫–∞–Ω–∞–ª –¥–ª—è –∑–∞–º–µ–Ω—ã `get_update_game_ready`
2. **RoundChannel** - WebSocket –∫–∞–Ω–∞–ª –¥–ª—è –∑–∞–º–µ–Ω—ã `get_round_update`
3. **VoteChannel** - WebSocket –∫–∞–Ω–∞–ª –¥–ª—è –∑–∞–º–µ–Ω—ã `get_vote_update`
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ broadcasting** –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–º–æ–≤, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
5. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WebSocket –∏ fallback –Ω–∞ polling
6. **–¢–µ—Å—Ç–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
7. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –≤–º–µ—Å—Ç–æ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–º–æ–≤ –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤)
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ polling
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º

### üöÄ –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSocket –∫–∞–Ω–∞–ª –¥–ª—è:
- `get_restart_update` (RestartChannel) 