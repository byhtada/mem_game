# Исправление проблем с очередями задач

## Проблемы, которые были исправлены:

1. **Конфликт систем очередей** - удален delayed_job, оставлен только Sidekiq
2. **Множественные контейнеры** - объединены в один оптимизированный
3. **Проблемы с временными зонами** - добавлена синхронизация времени
4. **Отсутствие логирования** - добавлено подробное логирование
5. **Неоптимальная конфигурация** - создан config/sidekiq.yml

## Шаги для применения исправлений:

### 1. Остановить текущие контейнеры
```bash
docker-compose down
```

### 2. Обновить зависимости
```bash
docker-compose build --no-cache
```

### 3. Запустить обновленную систему
```bash
docker-compose up -d
```

### 4. Проверить статус очередей
```bash
docker-compose exec web bundle exec rake queue:status
```

### 5. Мониторинг логов
```bash
# Основной Sidekiq
docker-compose logs -f sidekiq

# Bot Sidekiq
docker-compose logs -f sidekiq_bots
```

## Доступные команды для мониторинга:

```bash
# Статус очередей
docker-compose exec web bundle exec rake queue:status

# Показать задержанные задачи
docker-compose exec web bundle exec rake queue:delayed

# Очистить все очереди (только для отладки!)
docker-compose exec web bundle exec rake queue:clear

# Перезапустить неудачные задачи
docker-compose exec web bundle exec rake queue:retry_failed
```

## Основные улучшения:

- ✅ Единая система очередей (только Sidekiq)
- ✅ Правильная синхронизация времени в Docker
- ✅ Приоритеты очередей для лучшей производительности
- ✅ Подробное логирование для отладки
- ✅ Автоматические retry с экспоненциальной задержкой
- ✅ Мониторинг через Rake задачи
- ✅ Оптимизированная конфигурация Sidekiq

## Ожидаемые результаты:

1. **Точное выполнение по времени** - задачи будут выполняться в запланированное время
2. **Последовательное выполнение** - bot задачи будут выполняться по очереди без конфликтов
3. **Лучшая отладка** - подробные логи помогут выявить проблемы
4. **Меньше ресурсов** - один контейнер вместо четырех для bot задач 